<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Prévisions des accidents ayant entrainés des blessures/décès • ACC</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Prévisions des accidents ayant entrainés des blessures/décès">
<meta property="og:description" content="ACC">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ACC</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    <li class="dropdown-header">Description des données</li>
    <li>
      <a href="../articles/exploration-donnees-brutes.html">Exploration des données brutes</a>
    </li>
    <li>
      <a href="../articles/Stats_Descriptives.html">Statistiques descriptives avec ggplot2</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Classification</li>
    <li>
      <a href="../articles/ACM_classif.html">Analyses des Correspondances Multiples et Classification sur la base accidents</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Modélisation</li>
    <li>
      <a href="../articles/modeles.html">Prévisions des accidents ayant entrainés des blessures/décès</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ACCCertDS/ACC/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="modeles_files/header-attrs-2.5/header-attrs.js"></script><link href="modeles_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="modeles_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Prévisions des accidents ayant entrainés des blessures/décès</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ACCCertDS/ACC/blob/master/vignettes/modeles.Rmd"><code>vignettes/modeles.Rmd</code></a></small>
      <div class="hidden name"><code>modeles.Rmd</code></div>

    </div>

    
    
<p>Dans ce document on se propose de modéliser la variable <code>grav</code> afin de prévoir si un accident aura entraîné des blessures (ou le décès) ou non.</p>
<p>Nous chargeons les packages R nécessaires à cette étude.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; -- Attaching packages --------------------------------------- tidyverse 1.3.0 --</span>
<span class="co">#&gt; v ggplot2 3.3.2     v purrr   0.3.4</span>
<span class="co">#&gt; v tibble  3.0.4     v dplyr   1.0.2</span>
<span class="co">#&gt; v tidyr   1.1.2     v stringr 1.4.0</span>
<span class="co">#&gt; v readr   1.4.0     v forcats 0.5.0</span>
<span class="co">#&gt; -- Conflicts ------------------------------------------ tidyverse_conflicts() --</span>
<span class="co">#&gt; x dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rsample.tidymodels.org">rsample</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">doParallel</span><span class="op">)</span>        <span class="co"># pour paralléliser</span>
<span class="co">#&gt; Warning: le package 'doParallel' a été compilé avec la version R 4.0.3</span>
<span class="co">#&gt; Le chargement a nécessité le package : foreach</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attachement du package : 'foreach'</span>
<span class="co">#&gt; The following objects are masked from 'package:purrr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     accumulate, when</span>
<span class="co">#&gt; Le chargement a nécessité le package : iterators</span>
<span class="co">#&gt; Le chargement a nécessité le package : parallel</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: le package 'caret' a été compilé avec la version R 4.0.3</span>
<span class="co">#&gt; Le chargement a nécessité le package : lattice</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attachement du package : 'caret'</span>
<span class="co">#&gt; The following object is masked from 'package:purrr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     lift</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://glmnet.stanford.edu">glmnet</a></span><span class="op">)</span>
<span class="co">#&gt; Le chargement a nécessité le package : Matrix</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attachement du package : 'Matrix'</span>
<span class="co">#&gt; The following objects are masked from 'package:tidyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     expand, pack, unpack</span>
<span class="co">#&gt; Loaded glmnet 4.0-2</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/skimr">skimr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://sachsmc.github.io/plotROC">plotROC</a></span><span class="op">)</span> <span class="co"># Pour la courbe ROC et l'AUC</span>
<span class="co">#&gt; Warning: le package 'plotROC' a été compilé avec la version R 4.0.3</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://acccertds.github.io/ACC/">ACC</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attachement du package : 'ACC'</span>
<span class="co">#&gt; The following object is masked from 'package:tidyr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     population</span></code></pre></div>
<p>Création de l’indicatrice accident avec blessures (yc décès) oui/non</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">population</span>, package <span class="op">=</span> <span class="st">"ACC"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">accidents</span>, package <span class="op">=</span> <span class="st">"ACC"</span><span class="op">)</span>
<span class="va">accidents</span> <span class="op">=</span> <span class="fu"><a href="../reference/mutate_pour_modele.html">mutate_pour_modele</a></span><span class="op">(</span><span class="va">accidents</span>, <span class="va">population</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = "dep"</span>

<span class="va">accidents</span> <span class="op">&lt;-</span> <span class="va">accidents</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span>
      <span class="va">grav</span> <span class="op">==</span> <span class="st">"Indemne"</span>,<span class="st">"Indemne"</span>,
      <span class="st">"Blessures"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Num_Acc</span>,<span class="op">-</span><span class="va">grav</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Y</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html">mutate_if</a></span><span class="op">(</span><span class="va">is.character</span>, <span class="va">factor</span><span class="op">)</span>

<span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html">skim</a></span><span class="op">(</span><span class="va">accidents</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">accidents</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">480116</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">22</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">factor</td>
<td align="left">22</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table class="table">
<thead><tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">ordered</th>
<th align="right">n_unique</th>
<th align="left">top_counts</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Y</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">Ble: 283308, Ind: 196808</td>
</tr>
<tr class="even">
<td align="left">catu</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">3</td>
<td align="left">Con: 352837, Pas: 84454, Pié: 42825</td>
</tr>
<tr class="odd">
<td align="left">sexe</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">Mas: 330261, Fém: 149855</td>
</tr>
<tr class="even">
<td align="left">secu1</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="left">Voi: 287649, Deu: 87447, Aut: 47589, Pié: 42825</td>
</tr>
<tr class="odd">
<td align="left">catv</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">11</td>
<td align="left">VL : 317229, 2 r: 91965, VU : 26533, Bic: 18189</td>
</tr>
<tr class="even">
<td align="left">lum</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="left">Ple: 328909, Nui: 73723, Nui: 47243, Cré: 30241</td>
</tr>
<tr class="odd">
<td align="left">agg</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">2</td>
<td align="left">En : 297755, Hor: 182361</td>
</tr>
<tr class="even">
<td align="left">atm</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">9</td>
<td align="left">Nor: 388768, Plu: 49335, Tem: 14603, Plu: 10637</td>
</tr>
<tr class="odd">
<td align="left">col</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">6</td>
<td align="left">2 v: 138808, Aut: 135253, 2 v: 62946, 3 v: 61726</td>
</tr>
<tr class="even">
<td align="left">intersection</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="left">Hor: 329587, Int: 129291, Gir: 14785, Pla: 5800</td>
</tr>
<tr class="odd">
<td align="left">mois_acc</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">TRUE</td>
<td align="right">12</td>
<td align="left">jui: 45582, oct: 44628, jui: 43731, sep: 43429</td>
</tr>
<tr class="even">
<td align="left">jour_acc</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">TRUE</td>
<td align="right">7</td>
<td align="left">ven: 79923, jeu: 70085, sam: 69769, mer: 68885</td>
</tr>
<tr class="odd">
<td align="left">catr</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">5</td>
<td align="left">Voi: 216407, Rou: 167221, Aut: 52132, Rou: 34566</td>
</tr>
<tr class="even">
<td align="left">circ</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="left">Bid: 290007, A s: 84773, A c: 74650, Aut: 30686</td>
</tr>
<tr class="odd">
<td align="left">prof</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">3</td>
<td align="left">Pla: 367510, Pen: 69847, Aut: 42759</td>
</tr>
<tr class="even">
<td align="left">plan</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">3</td>
<td align="left">Rec: 362988, Non: 76349, Non: 40779</td>
</tr>
<tr class="odd">
<td align="left">surf</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">3</td>
<td align="left">Nor: 373685, Ano: 87698, Non: 18733</td>
</tr>
<tr class="even">
<td align="left">infra</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">3</td>
<td align="left">Non: 417492, Oui: 52820, Non: 9804</td>
</tr>
<tr class="odd">
<td align="left">situ</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">7</td>
<td align="left">Sur: 371402, Sur: 61979, Auc: 24299, Aut: 9369</td>
</tr>
<tr class="even">
<td align="left">gr_dep</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="left">1 0: 202824, 500: 106481, plu: 100431, moi: 70380</td>
</tr>
<tr class="odd">
<td align="left">classe_age</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">8</td>
<td align="left">25-: 102626, 15-: 99707, 35-: 77703, 45-: 69632</td>
</tr>
<tr class="even">
<td align="left">cl_heure</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="right">4</td>
<td align="left">16h: 152558, 10h: 133097, 20h: 100123, 7h-: 94338</td>
</tr>
</tbody>
</table>
<p>Compte tenu de la taille (480116 observations) de nos données et des capacités limitées de nos machines, nous sommes contraints de faire cette modélisation sur un échantillon de nos données.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_frac</a></span><span class="op">(</span><span class="va">accidents</span>, size <span class="op">=</span> <span class="fl">.20</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Afin de s’assurer qu’on n’a pas introduit un trop grand biais dans les données, on vérifie que les proportions de la variable d’intérêt <span class="math inline">\(Y\)</span> n’est pas très différent entre l’échantillon ci-dessus et les données initiales.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">accidents</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Blessures   Indemne </span>
<span class="co">#&gt; 0.5900824 0.4099176</span>

<span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Blessures   Indemne </span>
<span class="co">#&gt; 0.5875571 0.4124429</span></code></pre></div>
<p>On introduit les fonctions suivantes pour mesurer l’erreur de prévision de nos modèles ultérieurement.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">criteres_erreur_classif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Methode_abrev<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="op">)</span>,
                                      Methode<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">character</a></span><span class="op">(</span><span class="op">)</span>,
                                      Error<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span>,
                                      Sensitivity<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span>,
                                      Precision<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span>,
                                      Accuracy<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span>,
                                      Specificity<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span>,
                                      F1<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span>,
                                      AUC<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/double.html">double</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">eval_prev_classif</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prev_proba</span>, <span class="va">real</span>, <span class="va">methode_abrev</span>,<span class="va">methode</span><span class="op">)</span><span class="op">{</span>
  <span class="va">prev</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">prev_proba</span><span class="op">&gt;</span><span class="fl">0.5</span><span class="op">)</span><span class="op">*</span><span class="fl">1</span>
  
  <span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">real</span>,<span class="va">prev</span><span class="op">)</span>
  <span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="st">"Confusion matrix :"</span><span class="op">)</span>
  <span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">cm</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"cm"</span>,<span class="va">methode_abrev</span>,sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>,<span class="va">cm</span>,envir<span class="op">=</span><span class="va">.GlobalEnv</span><span class="op">)</span>
  
  <span class="va">cm_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">cm</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">cm</span><span class="op">)</span>,digits<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
  <span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="st">"Confusion matrix (%) :"</span><span class="op">)</span>
  <span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="va">cm_norm</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"cm_norm"</span>,<span class="va">methode_abrev</span>,sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span>,<span class="va">cm_norm</span>,envir<span class="op">=</span><span class="va">.GlobalEnv</span><span class="op">)</span>
  
  <span class="va">tp</span> <span class="op">&lt;-</span> <span class="va">cm</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>
  <span class="va">fp</span> <span class="op">&lt;-</span> <span class="va">cm</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span>
  <span class="va">tn</span> <span class="op">&lt;-</span> <span class="va">cm</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>
  <span class="va">fn</span> <span class="op">&lt;-</span> <span class="va">cm</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span>
  
  <span class="va">error</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">fp</span><span class="op">+</span><span class="va">fn</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">tp</span><span class="op">+</span><span class="va">tn</span><span class="op">+</span><span class="va">fp</span><span class="op">+</span><span class="va">fn</span><span class="op">)</span>
  <span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Classification error : "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">error</span>,digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">sensitivity</span> <span class="op">&lt;-</span> <span class="va">tp</span><span class="op">/</span><span class="op">(</span><span class="va">tp</span><span class="op">+</span><span class="va">fn</span><span class="op">)</span>
  <span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Sensitivity : "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">sensitivity</span>,digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">precision</span> <span class="op">&lt;-</span> <span class="va">tp</span><span class="op">/</span><span class="op">(</span><span class="va">tp</span><span class="op">+</span><span class="va">fp</span><span class="op">)</span>
  <span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Precision : "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">precision</span>,digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">accuracy</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">tp</span><span class="op">+</span><span class="va">tn</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">tp</span><span class="op">+</span><span class="va">tn</span><span class="op">+</span><span class="va">fp</span><span class="op">+</span><span class="va">fn</span><span class="op">)</span>
  <span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Accuracy : "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">accuracy</span>,digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">specificity</span> <span class="op">&lt;-</span> <span class="va">tn</span><span class="op">/</span><span class="op">(</span><span class="va">tn</span><span class="op">+</span><span class="va">fp</span><span class="op">)</span>
  <span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Specificity : "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">specificity</span>,digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">F1</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="va">precision</span><span class="op">*</span><span class="va">sensitivity</span><span class="op">/</span><span class="op">(</span><span class="va">precision</span><span class="op">+</span><span class="va">sensitivity</span><span class="op">)</span>
  <span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"F1 : "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">F1</span>,digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">is.factor</a></span><span class="op">(</span><span class="va">real</span><span class="op">)</span><span class="op">==</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">{</span>
    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>prev_proba<span class="op">=</span><span class="va">prev_proba</span>,
                     real<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">real</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">else</span><span class="op">{</span>
    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>prev_proba<span class="op">=</span><span class="va">prev_proba</span>,
                     real<span class="op">=</span><span class="va">real</span><span class="op">)</span>
  <span class="op">}</span>
  
  <span class="va">graph</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span>,<span class="fu">aes</span><span class="op">(</span>d<span class="op">=</span><span class="va">real</span>,m<span class="op">=</span><span class="va">prev_proba</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/plotROC/man/geom_roc.html">geom_roc</a></span><span class="op">(</span>labels<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  
  <span class="va">AUC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/plotROC/man/calc_auc.html">calc_auc</a></span><span class="op">(</span><span class="va">graph</span><span class="op">)</span><span class="op">$</span><span class="va">AUC</span>,digits<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
  <span class="fu"><a href="https://docs.ropensci.org/skimr/reference/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"AUC : "</span>,<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="va">AUC</span>,digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>
  
  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span><span class="op">(</span><span class="st">"criteres_erreur_classif"</span>,envir<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/environment.html">globalenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">tab</span>,<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Methode_abrev<span class="op">=</span><span class="va">methode_abrev</span>,
                              Methode<span class="op">=</span><span class="va">methode</span>,
                              Error<span class="op">=</span><span class="va">error</span>,
                              Sensitivity<span class="op">=</span><span class="va">sensitivity</span>,
                              Precision<span class="op">=</span><span class="va">precision</span>,
                              Accuracy<span class="op">=</span><span class="va">accuracy</span>,
                              Specificity<span class="op">=</span><span class="va">specificity</span>,
                              F1<span class="op">=</span><span class="va">F1</span>,
                              AUC<span class="op">=</span><span class="va">AUC</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="st">"criteres_erreur_classif"</span>,<span class="va">tab</span>,envir<span class="op">=</span><span class="va">.GlobalEnv</span><span class="op">)</span>
  
  <span class="va">graph</span><span class="op">+</span>
    <span class="fu"><a href="https://rdrr.io/pkg/plotROC/man/style_roc.html">style_roc</a></span><span class="op">(</span>theme<span class="op">=</span><span class="va">theme_grey</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">annotate</span><span class="op">(</span><span class="st">"text"</span>,x<span class="op">=</span><span class="fl">0.75</span>,y<span class="op">=</span><span class="fl">0.25</span>,label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"AUC="</span>,<span class="va">AUC</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
    <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Courbe ROC"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>On sépare d’abord nos données pour garder un échantillon de test sur lequel appliquer le modèle finalement sélectionné. Et on évaluera nos modèles par une méthode de validation croisée en 4 blocs.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">split</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">initial_split</a></span><span class="op">(</span><span class="va">data</span>, prop <span class="op">=</span> <span class="fl">3</span><span class="op">/</span><span class="fl">4</span>, strata <span class="op">=</span> <span class="va">Y</span><span class="op">)</span> 
<span class="va">don_apprentissage</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">training</a></span><span class="op">(</span><span class="va">split</span><span class="op">)</span>
<span class="va">don_test</span> <span class="op">&lt;-</span> <span class="fu">rsample</span><span class="fu">::</span><span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">testing</a></span><span class="op">(</span><span class="va">split</span><span class="op">)</span>

<span class="va">nb</span> <span class="op">=</span> <span class="fl">4</span>
<span class="va">blocs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nb</span>, length<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">don_apprentissage</span><span class="op">)</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>La fonction ci-après sera exécutée pour chacun des 4 blocs et permet d’ajuster plusieurs modèles aux données.</p>
<p>Pour des raisons de temps de calcul nous sommes contraints de ne pas exécuter les modèles SVM.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">predict_cv</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">bloc_ecart</span><span class="op">)</span> <span class="op">{</span>
  <span class="co">## Pour calcul parallèle des paramètres</span>
  <span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">makePSOCKcluster</span><span class="op">(</span><span class="fu">detectCores</span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">1L</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span> 
  
  <span class="co">## Données</span>
  <span class="va">train</span> <span class="op">&lt;-</span> <span class="va">don_apprentissage</span><span class="op">[</span><span class="va">blocs</span> <span class="op">!=</span> <span class="va">bloc_ecart</span>,<span class="op">]</span>
  <span class="va">test</span> <span class="op">&lt;-</span> <span class="va">don_apprentissage</span><span class="op">[</span><span class="va">blocs</span> <span class="op">==</span> <span class="va">bloc_ecart</span>,<span class="op">]</span>
  <span class="co">#matrices pour glmnet</span>
  <span class="va">train_matx</span> <span class="op">&lt;-</span> <span class="va">donX</span><span class="op">[</span><span class="va">blocs</span> <span class="op">!=</span> <span class="va">bloc_ecart</span>,<span class="op">]</span>
  <span class="va">train_y</span> <span class="op">&lt;-</span> <span class="va">donY</span><span class="op">[</span><span class="va">blocs</span> <span class="op">!=</span> <span class="va">bloc_ecart</span><span class="op">]</span>
  <span class="va">test_matx</span> <span class="op">&lt;-</span> <span class="va">donX</span><span class="op">[</span><span class="va">blocs</span> <span class="op">==</span> <span class="va">bloc_ecart</span>,<span class="op">]</span> 
  
  <span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
  <span class="co">## Modèles</span>
  <span class="va">mod_lin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">fml</span> , data<span class="op">=</span><span class="va">train</span>, method<span class="op">=</span><span class="st">"glm"</span>, trControl<span class="op">=</span><span class="va">controle</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span>
  <span class="va">mod_ridge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html">cv.glmnet</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">train_matx</span>, y <span class="op">=</span> <span class="va">train_y</span>, alpha <span class="op">=</span> <span class="fl">0</span>, parallel <span class="op">=</span> <span class="cn">T</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span>
  <span class="va">mod_lasso</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html">cv.glmnet</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">train_matx</span>, y <span class="op">=</span> <span class="va">train_y</span>, alpha <span class="op">=</span> <span class="fl">1</span>, parallel <span class="op">=</span> <span class="cn">T</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span>
  <span class="va">mod_elnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glmnet.stanford.edu/reference/cv.glmnet.html">cv.glmnet</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">train_matx</span>, y <span class="op">=</span> <span class="va">train_y</span>, alpha <span class="op">=</span> <span class="fl">0.5</span>, parallel <span class="op">=</span> <span class="cn">T</span>, family <span class="op">=</span> <span class="st">"binomial"</span><span class="op">)</span>
  <span class="va">mod_rf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">fml</span> ,data<span class="op">=</span><span class="va">train</span>,method<span class="op">=</span><span class="st">"ranger"</span>,trControl<span class="op">=</span><span class="va">controle</span>, tuneGrid<span class="op">=</span><span class="va">rf_grid</span><span class="op">)</span>
  <span class="va">mod_Adaboost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">fml</span>, data <span class="op">=</span> <span class="va">train</span>, method<span class="op">=</span><span class="st">"gbm"</span>,distribution<span class="op">=</span><span class="st">"adaboost"</span>, tuneGrid <span class="op">=</span> <span class="va">boosting_grille</span>,  trControl<span class="op">=</span><span class="va">controle</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="va">mod_Logitboost</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">fml</span>, data <span class="op">=</span> <span class="va">train</span>, method<span class="op">=</span><span class="st">"LogitBoost"</span>, trControl<span class="op">=</span><span class="va">controle</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
  <span class="co"># mod_svm &lt;- train(fml, data = train, method="svmLinear", tuneGrid = svr_C_Grid, trControl=controle)</span>
  <span class="co"># mod_svm_poly_d2 &lt;- train(fml, data = train, method="svmPoly", tuneGrid = svr_poly_grid, trControl=controle)</span>
  <span class="va">mod_nnet</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">fml</span>, data <span class="op">=</span> <span class="va">train</span>, method<span class="op">=</span><span class="st">"nnet"</span>,  trControl<span class="op">=</span><span class="va">controle</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

  <span class="fu">stopCluster</span><span class="op">(</span><span class="va">cl</span><span class="op">)</span>
  
  <span class="co">## Previsions</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span> Y <span class="op">=</span> <span class="va">test</span><span class="op">$</span><span class="va">Y</span>,
          reg_lin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_lin</span>, <span class="va">test</span>, type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,
          ridge <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_ridge</span>, <span class="va">test_matx</span>, type <span class="op">=</span><span class="st">"response"</span>, s<span class="op">=</span><span class="st">"lambda.1se"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,
          lasso <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_lasso</span>, <span class="va">test_matx</span>, type <span class="op">=</span><span class="st">"response"</span>, s<span class="op">=</span><span class="st">"lambda.1se"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,
          elnet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_elnet</span>, <span class="va">test_matx</span>, type <span class="op">=</span><span class="st">"response"</span>, s<span class="op">=</span><span class="st">"lambda.1se"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,
          rf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_rf</span>, <span class="va">test</span>, type <span class="op">=</span><span class="st">"prob"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,
          adaboost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_Adaboost</span>, <span class="va">test</span>, type <span class="op">=</span><span class="st">"prob"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,
          logitboost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_Logitboost</span>, <span class="va">test</span>, type <span class="op">=</span><span class="st">"prob"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,
          <span class="co"># svm = predict(mod_svm, test, type ="prob")[,2],</span>
          <span class="co"># svm_poly_d2 = predict(mod_svm_poly_d2, test, type ="prob")[,2],</span>
          neuralnet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">mod_nnet</span>, <span class="va">test</span>, type <span class="op">=</span><span class="st">"prob"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
  <span class="op">)</span> 

<span class="op">}</span>


<span class="co"># Paramètres pour caret</span>
<span class="va">controle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"cv"</span>,number<span class="op">=</span><span class="fl">4</span>, allowParallel <span class="op">=</span> <span class="cn">TRUE</span>, classProbs<span class="op">=</span><span class="cn">TRUE</span>, verboseIter <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>

<span class="co">## Grilles de recherches d'hyper paramètres</span>
<span class="va">rf_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>mtry<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq.int</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span><span class="op">(</span><span class="va">don_apprentissage</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, splitrule <span class="op">=</span> <span class="st">"gini"</span>, min.node.size<span class="op">=</span><span class="fl">1L</span><span class="op">)</span> 
<span class="co"># svr_C_Grid &lt;-  expand.grid(C = seq(0.001, 2, length = 10))</span>
<span class="co"># svr_poly_grid &lt;- expand.grid(C = seq(0.001, 2, length = 10), degree =2, scale = 1)</span>
<span class="va">boosting_grille</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span>n.trees <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">25</span>,<span class="fl">5</span><span class="op">)</span><span class="op">*</span><span class="fl">50</span>, shrinkage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.0001</span>,<span class="fl">0.001</span>,<span class="fl">0.01</span>,<span class="fl">0.1</span>,<span class="fl">1</span><span class="op">)</span>, n.minobsinnode <span class="op">=</span> <span class="fl">10</span>, interaction.depth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>Dans un premier temps nous allons modéliser selon la formule suivante</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">fml</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="st">"Y ~ ."</span><span class="op">)</span>

<span class="co">## Données format matrice pour glmnet</span>
<span class="va">donX</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span><span class="va">fml</span>,data<span class="op">=</span><span class="va">don_apprentissage</span><span class="op">)</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>
<span class="va">donY</span> <span class="op">&lt;-</span> <span class="va">don_apprentissage</span><span class="op">$</span><span class="va">Y</span></code></pre></div>
<p>Les résultats de la validation croisée en 4 blocs sont les suivants :</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">resultats</span> <span class="op">=</span> <span class="fu">map_dfr</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">nb</span>,<span class="va">predict_cv</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resultats</span>
<span class="co">#&gt; # A tibble: 72,018 x 9</span>
<span class="co">#&gt;    Y         reg_lin  ridge  lasso  elnet    rf adaboost logitboost neuralnet</span>
<span class="co">#&gt;    &lt;fct&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Blessures  0.0111 0.0662 0.0287 0.0339 0.261   0.100    0.000911     0.413</span>
<span class="co">#&gt;  2 Blessures  0.302  0.100  0.140  0.127  0.221   0.125    0.0474       0.413</span>
<span class="co">#&gt;  3 Indemne    0.304  0.317  0.297  0.298  0.447   0.344    0.269        0.413</span>
<span class="co">#&gt;  4 Blessures  0.244  0.256  0.280  0.277  0.242   0.197    0.269        0.413</span>
<span class="co">#&gt;  5 Blessures  0.0462 0.183  0.0948 0.112  0.238   0.112    0.00669      0.413</span>
<span class="co">#&gt;  6 Indemne    0.462  0.478  0.459  0.464  0.525   0.459    0.731        0.413</span>
<span class="co">#&gt;  7 Blessures  0.227  0.494  0.343  0.379  0.213   0.311    0.731        0.413</span>
<span class="co">#&gt;  8 Blessures  0.115  0.172  0.124  0.134  0.152   0.0956   0.000911     0.413</span>
<span class="co">#&gt;  9 Indemne    0.655  0.605  0.666  0.657  0.593   0.692    0.731        0.413</span>
<span class="co">#&gt; 10 Indemne    0.717  0.628  0.650  0.647  0.704   0.737    0.731        0.413</span>
<span class="co">#&gt; # ... with 72,008 more rows</span></code></pre></div>
<p>La fonction introduite précédemment <code>predict_cv</code> ajuste les types de modèles suivants :</p>
<ul>
<li>régression logistique</li>
<li>régression logistique ridge</li>
<li>régression logistique lasso</li>
<li>régression logistique elastic net</li>
<li>forêt aléatoire</li>
<li>gradient boosting méthode Adaboost</li>
<li>gradient boosting méthode Logitboost</li>
<li>réseau de neurones.</li>
</ul>
<p>Comparons les résultats de ces différentes méthodes</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R">

<span class="fu">eval_prev_classif</span><span class="op">(</span>prev<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">elnet</span>,       real<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">Y</span>, methode<span class="op">=</span><span class="st">"Régression linéaire"</span>,                methode_abrev<span class="op">=</span><span class="st">"lm"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Confusion matrix :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real            0     1</span>
<span class="co">#&gt;   Blessures 32389  9926</span>
<span class="co">#&gt;   Indemne    7690 22013</span>
<span class="co">#&gt; [1] "Confusion matrix (%) :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real           0    1</span>
<span class="co">#&gt;   Blessures 45.0 13.8</span>
<span class="co">#&gt;   Indemne   10.7 30.6</span>
<span class="co">#&gt; [1] "Classification error : 0.245"</span>
<span class="co">#&gt; [1] "Sensitivity : 0.741"</span>
<span class="co">#&gt; [1] "Precision : 0.689"</span>
<span class="co">#&gt; [1] "Accuracy : 0.755"</span>
<span class="co">#&gt; [1] "Specificity : 0.765"</span>
<span class="co">#&gt; [1] "F1 : 0.714"</span>
<span class="co">#&gt; [1] "AUC : 0.83"</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">eval_prev_classif</span><span class="op">(</span>prev<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">elnet</span>,       real<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">Y</span>, methode<span class="op">=</span><span class="st">"Régression pénalisée : Ridge"</span>,       methode_abrev<span class="op">=</span><span class="st">"ridge"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Confusion matrix :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real            0     1</span>
<span class="co">#&gt;   Blessures 32389  9926</span>
<span class="co">#&gt;   Indemne    7690 22013</span>
<span class="co">#&gt; [1] "Confusion matrix (%) :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real           0    1</span>
<span class="co">#&gt;   Blessures 45.0 13.8</span>
<span class="co">#&gt;   Indemne   10.7 30.6</span>
<span class="co">#&gt; [1] "Classification error : 0.245"</span>
<span class="co">#&gt; [1] "Sensitivity : 0.741"</span>
<span class="co">#&gt; [1] "Precision : 0.689"</span>
<span class="co">#&gt; [1] "Accuracy : 0.755"</span>
<span class="co">#&gt; [1] "Specificity : 0.765"</span>
<span class="co">#&gt; [1] "F1 : 0.714"</span>
<span class="co">#&gt; [1] "AUC : 0.83"</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-10-2.png" width="672"></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">eval_prev_classif</span><span class="op">(</span>prev<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">elnet</span>,       real<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">Y</span>, methode<span class="op">=</span><span class="st">"Régression pénalisée : Lasso"</span>,       methode_abrev<span class="op">=</span><span class="st">"lasso"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Confusion matrix :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real            0     1</span>
<span class="co">#&gt;   Blessures 32389  9926</span>
<span class="co">#&gt;   Indemne    7690 22013</span>
<span class="co">#&gt; [1] "Confusion matrix (%) :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real           0    1</span>
<span class="co">#&gt;   Blessures 45.0 13.8</span>
<span class="co">#&gt;   Indemne   10.7 30.6</span>
<span class="co">#&gt; [1] "Classification error : 0.245"</span>
<span class="co">#&gt; [1] "Sensitivity : 0.741"</span>
<span class="co">#&gt; [1] "Precision : 0.689"</span>
<span class="co">#&gt; [1] "Accuracy : 0.755"</span>
<span class="co">#&gt; [1] "Specificity : 0.765"</span>
<span class="co">#&gt; [1] "F1 : 0.714"</span>
<span class="co">#&gt; [1] "AUC : 0.83"</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-10-3.png" width="672"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">eval_prev_classif</span><span class="op">(</span>prev<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">elnet</span>,       real<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">Y</span>, methode<span class="op">=</span><span class="st">"Régression pénalisée : Elastic-net"</span>, methode_abrev<span class="op">=</span><span class="st">"elnet"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Confusion matrix :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real            0     1</span>
<span class="co">#&gt;   Blessures 32389  9926</span>
<span class="co">#&gt;   Indemne    7690 22013</span>
<span class="co">#&gt; [1] "Confusion matrix (%) :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real           0    1</span>
<span class="co">#&gt;   Blessures 45.0 13.8</span>
<span class="co">#&gt;   Indemne   10.7 30.6</span>
<span class="co">#&gt; [1] "Classification error : 0.245"</span>
<span class="co">#&gt; [1] "Sensitivity : 0.741"</span>
<span class="co">#&gt; [1] "Precision : 0.689"</span>
<span class="co">#&gt; [1] "Accuracy : 0.755"</span>
<span class="co">#&gt; [1] "Specificity : 0.765"</span>
<span class="co">#&gt; [1] "F1 : 0.714"</span>
<span class="co">#&gt; [1] "AUC : 0.83"</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-10-4.png" width="672"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">eval_prev_classif</span><span class="op">(</span>prev<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">rf</span>,          real<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">Y</span>, methode<span class="op">=</span><span class="st">"Random Forest"</span>,                      methode_abrev<span class="op">=</span><span class="st">"RF"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Confusion matrix :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real            0     1</span>
<span class="co">#&gt;   Blessures 33539  8776</span>
<span class="co">#&gt;   Indemne    8178 21525</span>
<span class="co">#&gt; [1] "Confusion matrix (%) :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real           0    1</span>
<span class="co">#&gt;   Blessures 46.6 12.2</span>
<span class="co">#&gt;   Indemne   11.4 29.9</span>
<span class="co">#&gt; [1] "Classification error : 0.235"</span>
<span class="co">#&gt; [1] "Sensitivity : 0.725"</span>
<span class="co">#&gt; [1] "Precision : 0.71"</span>
<span class="co">#&gt; [1] "Accuracy : 0.765"</span>
<span class="co">#&gt; [1] "Specificity : 0.793"</span>
<span class="co">#&gt; [1] "F1 : 0.717"</span>
<span class="co">#&gt; [1] "AUC : 0.84"</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-10-5.png" width="672"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">eval_prev_classif</span><span class="op">(</span>prev<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">adaboost</span>,      real<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">Y</span>, methode<span class="op">=</span><span class="st">"Gradient boosting : adaboost"</span>,     methode_abrev<span class="op">=</span><span class="st">"gbm_ada"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Confusion matrix :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real            0     1</span>
<span class="co">#&gt;   Blessures 33302  9013</span>
<span class="co">#&gt;   Indemne    7696 22007</span>
<span class="co">#&gt; [1] "Confusion matrix (%) :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real           0    1</span>
<span class="co">#&gt;   Blessures 46.2 12.5</span>
<span class="co">#&gt;   Indemne   10.7 30.6</span>
<span class="co">#&gt; [1] "Classification error : 0.232"</span>
<span class="co">#&gt; [1] "Sensitivity : 0.741"</span>
<span class="co">#&gt; [1] "Precision : 0.709"</span>
<span class="co">#&gt; [1] "Accuracy : 0.768"</span>
<span class="co">#&gt; [1] "Specificity : 0.787"</span>
<span class="co">#&gt; [1] "F1 : 0.725"</span>
<span class="co">#&gt; [1] "AUC : 0.85"</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-10-6.png" width="672"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">eval_prev_classif</span><span class="op">(</span>prev<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">logitboost</span>,      real<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">Y</span>, methode<span class="op">=</span><span class="st">"Gradient boosting : logitboost"</span>, methode_abrev<span class="op">=</span><span class="st">"gbm_logit"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Confusion matrix :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real            0     1</span>
<span class="co">#&gt;   Blessures 27471 14844</span>
<span class="co">#&gt;   Indemne    5785 23918</span>
<span class="co">#&gt; [1] "Confusion matrix (%) :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real           0    1</span>
<span class="co">#&gt;   Blessures 38.1 20.6</span>
<span class="co">#&gt;   Indemne    8.0 33.2</span>
<span class="co">#&gt; [1] "Classification error : 0.286"</span>
<span class="co">#&gt; [1] "Sensitivity : 0.805"</span>
<span class="co">#&gt; [1] "Precision : 0.617"</span>
<span class="co">#&gt; [1] "Accuracy : 0.714"</span>
<span class="co">#&gt; [1] "Specificity : 0.649"</span>
<span class="co">#&gt; [1] "F1 : 0.699"</span>
<span class="co">#&gt; [1] "AUC : 0.75"</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-10-7.png" width="672"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">eval_prev_classif</span><span class="op">(</span>prev<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">neuralnet</span>,   real<span class="op">=</span><span class="va">resultats</span><span class="op">$</span><span class="va">Y</span>, methode<span class="op">=</span><span class="st">"Réseau de neurones : nnet"</span>,          methode_abrev<span class="op">=</span><span class="st">"nnet"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Confusion matrix :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real            0     1</span>
<span class="co">#&gt;   Blessures 37874  4441</span>
<span class="co">#&gt;   Indemne   18788 10915</span>
<span class="co">#&gt; [1] "Confusion matrix (%) :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real           0    1</span>
<span class="co">#&gt;   Blessures 52.6  6.2</span>
<span class="co">#&gt;   Indemne   26.1 15.2</span>
<span class="co">#&gt; [1] "Classification error : 0.323"</span>
<span class="co">#&gt; [1] "Sensitivity : 0.367"</span>
<span class="co">#&gt; [1] "Precision : 0.711"</span>
<span class="co">#&gt; [1] "Accuracy : 0.677"</span>
<span class="co">#&gt; [1] "Specificity : 0.895"</span>
<span class="co">#&gt; [1] "F1 : 0.484"</span>
<span class="co">#&gt; [1] "AUC : 0.72"</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-10-8.png" width="672"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">criteres_erreur_classif</span>
<span class="co">#&gt;   Methode_abrev                            Methode     Error Sensitivity</span>
<span class="co">#&gt; 1            lm                Régression linéaire 0.2446055   0.7411036</span>
<span class="co">#&gt; 2         ridge       Régression pénalisée : Ridge 0.2446055   0.7411036</span>
<span class="co">#&gt; 3         lasso       Régression pénalisée : Lasso 0.2446055   0.7411036</span>
<span class="co">#&gt; 4         elnet Régression pénalisée : Elastic-net 0.2446055   0.7411036</span>
<span class="co">#&gt; 5            RF                      Random Forest 0.2354134   0.7246743</span>
<span class="co">#&gt; 6       gbm_ada       Gradient boosting : adaboost 0.2320114   0.7409016</span>
<span class="co">#&gt; 7     gbm_logit     Gradient boosting : logitboost 0.2864423   0.8052385</span>
<span class="co">#&gt; 8          nnet          Réseau de neurones : nnet 0.3225444   0.3674713</span>
<span class="co">#&gt;   Precision  Accuracy Specificity        F1  AUC</span>
<span class="co">#&gt; 1 0.6892201 0.7553945   0.7654260 0.7142208 0.83</span>
<span class="co">#&gt; 2 0.6892201 0.7553945   0.7654260 0.7142208 0.83</span>
<span class="co">#&gt; 3 0.6892201 0.7553945   0.7654260 0.7142208 0.83</span>
<span class="co">#&gt; 4 0.6892201 0.7553945   0.7654260 0.7142208 0.83</span>
<span class="co">#&gt; 5 0.7103726 0.7645866   0.7926031 0.7174522 0.84</span>
<span class="co">#&gt; 6 0.7094455 0.7679886   0.7870022 0.7248324 0.85</span>
<span class="co">#&gt; 7 0.6170476 0.7135577   0.6492024 0.6986928 0.75</span>
<span class="co">#&gt; 8 0.7107971 0.6774556   0.8950490 0.4844759 0.72</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">criteres_erreur_classif_plot</span> <span class="op">&lt;-</span> <span class="va">criteres_erreur_classif</span>
<span class="va">error_min</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">criteres_erreur_classif_plot</span><span class="op">$</span><span class="va">Error</span><span class="op">)</span>
<span class="va">error_min</span>
<span class="co">#&gt; [1] 0.2320114</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">error_max</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">criteres_erreur_classif_plot</span><span class="op">$</span><span class="va">Error</span><span class="op">)</span>
<span class="va">error_max</span>
<span class="co">#&gt; [1] 0.3225444</span></code></pre></div>
<p>On peut également représenter graphiquement ces résultats en regroupant toutes les courbes ROC sur un même graphique :</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resultats</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">methode</span>, <span class="va">prev_proba</span>, <span class="op">-</span><span class="va">Y</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>d<span class="op">=</span><span class="va">Y</span>, m<span class="op">=</span><span class="va">prev_proba</span>, color <span class="op">=</span> <span class="va">methode</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/plotROC/man/geom_roc.html">geom_roc</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/plotROC/man/style_roc.html">style_roc</a></span><span class="op">(</span>theme <span class="op">=</span> <span class="va">theme_grey</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>title<span class="op">=</span><span class="st">"Courbes ROC"</span><span class="op">)</span>
<span class="co">#&gt; Warning: attributes are not identical across measure variables;</span>
<span class="co">#&gt; they will be dropped</span>
<span class="co">#&gt; Warning in verify_d(data$d): D not labeled 0/1, assuming Blessures = 0 and</span>
<span class="co">#&gt; Indemne = 1!</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>Ou bien en mesurant l’erreur :</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data<span class="op">=</span><span class="va">criteres_erreur_classif_plot</span>,<span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">Methode</span>,y<span class="op">=</span><span class="va">Error</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>,fill<span class="op">=</span><span class="st">"steelblue"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept<span class="op">=</span><span class="va">error_min</span>,color<span class="op">=</span><span class="st">"red"</span>,size<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">0</span>,to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="va">error_max</span><span class="op">)</span>,by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Méthode"</span>,y<span class="op">=</span><span class="st">"Erreur de classification"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data<span class="op">=</span><span class="va">criteres_erreur_classif_plot</span>,<span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">Methode</span>,y<span class="op">=</span><span class="fl">100</span><span class="op">*</span><span class="va">Error</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span>stat<span class="op">=</span><span class="st">"identity"</span>,fill<span class="op">=</span><span class="st">"steelblue"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_hline</span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">100</span><span class="op">*</span><span class="va">error_min</span>,color<span class="op">=</span><span class="st">"red"</span>,size<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_y_continuous</span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span>from<span class="op">=</span><span class="fl">0</span>,to<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html">ceiling</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="va">error_max</span><span class="op">)</span>,by<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>axis.text.x<span class="op">=</span><span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">"Méthode"</span>,y<span class="op">=</span><span class="st">"Erreur de classification (%)"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<div id="modèle-de-mélange-i-erreur-moyenne-sur-tous-les-modèles" class="section level2">
<h2 class="hasAnchor">
<a href="#mod%C3%A8le-de-m%C3%A9lange-i-erreur-moyenne-sur-tous-les-mod%C3%A8les" class="anchor"></a>Modèle de mélange I (erreur moyenne sur tous les modèles )</h2>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">moyenne_mod</span> <span class="op">&lt;-</span> <span class="va">resultats</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>moyenne <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">c_across</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"Y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu">eval_prev_classif</span><span class="op">(</span>prev_proba <span class="op">=</span> <span class="va">moyenne_mod</span><span class="op">$</span><span class="va">moyenne</span>,
                  real <span class="op">=</span> <span class="va">moyenne_mod</span><span class="op">$</span><span class="va">Y</span>,
                  methode_abrev <span class="op">=</span> <span class="st">"agreg_moy"</span>,
                  methode <span class="op">=</span> <span class="st">"Agrégation moyenne"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Confusion matrix :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real            0     1</span>
<span class="co">#&gt;   Blessures 32805  9510</span>
<span class="co">#&gt;   Indemne    7429 22274</span>
<span class="co">#&gt; [1] "Confusion matrix (%) :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real           0    1</span>
<span class="co">#&gt;   Blessures 45.6 13.2</span>
<span class="co">#&gt;   Indemne   10.3 30.9</span>
<span class="co">#&gt; [1] "Classification error : 0.235"</span>
<span class="co">#&gt; [1] "Sensitivity : 0.75"</span>
<span class="co">#&gt; [1] "Precision : 0.701"</span>
<span class="co">#&gt; [1] "Accuracy : 0.765"</span>
<span class="co">#&gt; [1] "Specificity : 0.775"</span>
<span class="co">#&gt; [1] "F1 : 0.725"</span>
<span class="co">#&gt; [1] "AUC : 0.84"</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
</div>
<div id="modèle-de-mélange-ii-max" class="section level2">
<h2 class="hasAnchor">
<a href="#mod%C3%A8le-de-m%C3%A9lange-ii-max" class="anchor"></a>Modèle de mélange II (max)</h2>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">max_mod</span> <span class="op">&lt;-</span> <span class="va">resultats</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>max <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">c_across</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"Y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu">eval_prev_classif</span><span class="op">(</span>prev_proba <span class="op">=</span> <span class="va">max_mod</span><span class="op">$</span><span class="va">max</span>,
                  real <span class="op">=</span> <span class="va">max_mod</span><span class="op">$</span><span class="va">Y</span>,
                  methode_abrev <span class="op">=</span> <span class="st">"agreg_max"</span>,
                  methode <span class="op">=</span> <span class="st">"Agrégation moyenne"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Confusion matrix :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real            0     1</span>
<span class="co">#&gt;   Blessures 24832 17483</span>
<span class="co">#&gt;   Indemne    3408 26295</span>
<span class="co">#&gt; [1] "Confusion matrix (%) :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real           0    1</span>
<span class="co">#&gt;   Blessures 34.5 24.3</span>
<span class="co">#&gt;   Indemne    4.7 36.5</span>
<span class="co">#&gt; [1] "Classification error : 0.29"</span>
<span class="co">#&gt; [1] "Sensitivity : 0.885"</span>
<span class="co">#&gt; [1] "Precision : 0.601"</span>
<span class="co">#&gt; [1] "Accuracy : 0.71"</span>
<span class="co">#&gt; [1] "Specificity : 0.587"</span>
<span class="co">#&gt; [1] "F1 : 0.716"</span>
<span class="co">#&gt; [1] "AUC : 0.81"</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
</div>
<div id="modèle-de-mélange-iii-min" class="section level2">
<h2 class="hasAnchor">
<a href="#mod%C3%A8le-de-m%C3%A9lange-iii-min" class="anchor"></a>Modèle de mélange III (min)</h2>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">min_mod</span> <span class="op">&lt;-</span> <span class="va">resultats</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>min <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">c_across</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="st">"Y"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu">eval_prev_classif</span><span class="op">(</span>prev_proba <span class="op">=</span> <span class="va">min_mod</span><span class="op">$</span><span class="va">min</span>,
                  real <span class="op">=</span> <span class="va">min_mod</span><span class="op">$</span><span class="va">Y</span>,
                  methode_abrev <span class="op">=</span> <span class="st">"agreg_min"</span>,
                  methode <span class="op">=</span> <span class="st">"Agrégation moyenne"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Confusion matrix :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real            0     1</span>
<span class="co">#&gt;   Blessures 39381  2934</span>
<span class="co">#&gt;   Indemne   20566  9137</span>
<span class="co">#&gt; [1] "Confusion matrix (%) :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real           0    1</span>
<span class="co">#&gt;   Blessures 54.7  4.1</span>
<span class="co">#&gt;   Indemne   28.6 12.7</span>
<span class="co">#&gt; [1] "Classification error : 0.326"</span>
<span class="co">#&gt; [1] "Sensitivity : 0.308"</span>
<span class="co">#&gt; [1] "Precision : 0.757"</span>
<span class="co">#&gt; [1] "Accuracy : 0.674"</span>
<span class="co">#&gt; [1] "Specificity : 0.931"</span>
<span class="co">#&gt; [1] "F1 : 0.437"</span>
<span class="co">#&gt; [1] "AUC : 0.82"</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">criteres_erreur_classif</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">Error</span><span class="op">)</span>
<span class="co">#&gt;    Methode_abrev                            Methode     Error Sensitivity</span>
<span class="co">#&gt; 1        gbm_ada       Gradient boosting : adaboost 0.2320114   0.7409016</span>
<span class="co">#&gt; 2      agreg_moy                 Agrégation moyenne 0.2352051   0.7498906</span>
<span class="co">#&gt; 3             RF                      Random Forest 0.2354134   0.7246743</span>
<span class="co">#&gt; 4             lm                Régression linéaire 0.2446055   0.7411036</span>
<span class="co">#&gt; 5          ridge       Régression pénalisée : Ridge 0.2446055   0.7411036</span>
<span class="co">#&gt; 6          lasso       Régression pénalisée : Lasso 0.2446055   0.7411036</span>
<span class="co">#&gt; 7          elnet Régression pénalisée : Elastic-net 0.2446055   0.7411036</span>
<span class="co">#&gt; 8      gbm_logit     Gradient boosting : logitboost 0.2864423   0.8052385</span>
<span class="co">#&gt; 9      agreg_max                 Agrégation moyenne 0.2900803   0.8852641</span>
<span class="co">#&gt; 10          nnet          Réseau de neurones : nnet 0.3225444   0.3674713</span>
<span class="co">#&gt; 11     agreg_min                 Agrégation moyenne 0.3263073   0.3076120</span>
<span class="co">#&gt;    Precision  Accuracy Specificity        F1  AUC</span>
<span class="co">#&gt; 1  0.7094455 0.7679886   0.7870022 0.7248324 0.85</span>
<span class="co">#&gt; 2  0.7007929 0.7647949   0.7752570 0.7245109 0.84</span>
<span class="co">#&gt; 3  0.7103726 0.7645866   0.7926031 0.7174522 0.84</span>
<span class="co">#&gt; 4  0.6892201 0.7553945   0.7654260 0.7142208 0.83</span>
<span class="co">#&gt; 5  0.6892201 0.7553945   0.7654260 0.7142208 0.83</span>
<span class="co">#&gt; 6  0.6892201 0.7553945   0.7654260 0.7142208 0.83</span>
<span class="co">#&gt; 7  0.6892201 0.7553945   0.7654260 0.7142208 0.83</span>
<span class="co">#&gt; 8  0.6170476 0.7135577   0.6492024 0.6986928 0.75</span>
<span class="co">#&gt; 9  0.6006442 0.7099197   0.5868368 0.7156952 0.81</span>
<span class="co">#&gt; 10 0.7107971 0.6774556   0.8950490 0.4844759 0.72</span>
<span class="co">#&gt; 11 0.7569381 0.6736927   0.9306629 0.4374491 0.82</span></code></pre></div>
<p>On remarque que l’aggrégation des différents modèles par la moyenne, donne de bons résultats néanmoins, dans un souci de sélectionner un modèle parcimonieux, nous ne retiendrons pas cette solution.</p>
</div>
<div id="synthèse" class="section level2">
<h2 class="hasAnchor">
<a href="#synth%C3%A8se" class="anchor"></a>Synthèse</h2>
<p>Ainsi pour cette étude, les méthodes de gradient boosting, plus précisément, la méthode Adaboost, donnent de meilleures prédictions au sens du taux de mal classés que les autres méthodes.</p>
<p>En optimisant les paramètres de l’algorithme de gradient boosting sur l’échantillon d’apprentissage nous avons trouvé une erreur d’environ 23,2%. La méthode étant choisie, il nous faut maintenant définir un modèle final.</p>
<p>Pour ce faire nous appliquons de nouveau la méthodologie de validation croisée pour optimiser ces paramètres.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu">makePSOCKcluster</span><span class="op">(</span><span class="fu">detectCores</span><span class="op">(</span><span class="op">)</span><span class="op">-</span><span class="fl">1L</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span> 
<span class="va">modele_fin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span><span class="va">fml</span>,
                    data <span class="op">=</span> <span class="va">don_apprentissage</span>,
                    method<span class="op">=</span><span class="st">"gbm"</span>,
                    distribution<span class="op">=</span><span class="st">"adaboost"</span>,
                    tuneGrid <span class="op">=</span> <span class="va">boosting_grille</span>,
                    trControl<span class="op">=</span><span class="va">controle</span>,
                    verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="fu">stopCluster</span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modele_fin</span>
<span class="co">#&gt; Stochastic Gradient Boosting </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; 72018 samples</span>
<span class="co">#&gt;    21 predictor</span>
<span class="co">#&gt;     2 classes: 'Blessures', 'Indemne' </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; No pre-processing</span>
<span class="co">#&gt; Resampling: Cross-Validated (4 fold) </span>
<span class="co">#&gt; Summary of sample sizes: 54013, 54013, 54015, 54013 </span>
<span class="co">#&gt; Resampling results across tuning parameters:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   shrinkage  n.trees  Accuracy   Kappa    </span>
<span class="co">#&gt;   1e-04        50     0.5875614  0.0000000</span>
<span class="co">#&gt;   1e-04       300     0.5875614  0.0000000</span>
<span class="co">#&gt;   1e-04       550     0.5875614  0.0000000</span>
<span class="co">#&gt;   1e-04       800     0.5875614  0.0000000</span>
<span class="co">#&gt;   1e-04      1050     0.5875614  0.0000000</span>
<span class="co">#&gt;   1e-03        50     0.5875614  0.0000000</span>
<span class="co">#&gt;   1e-03       300     0.5875614  0.0000000</span>
<span class="co">#&gt;   1e-03       550     0.5875614  0.0000000</span>
<span class="co">#&gt;   1e-03       800     0.7081979  0.3639756</span>
<span class="co">#&gt;   1e-03      1050     0.6961871  0.3511448</span>
<span class="co">#&gt;   1e-02        50     0.5875614  0.0000000</span>
<span class="co">#&gt;   1e-02       300     0.7205561  0.4266343</span>
<span class="co">#&gt;   1e-02       550     0.7395513  0.4660778</span>
<span class="co">#&gt;   1e-02       800     0.7442168  0.4755408</span>
<span class="co">#&gt;   1e-02      1050     0.7483824  0.4850309</span>
<span class="co">#&gt;   1e-01        50     0.7369825  0.4606093</span>
<span class="co">#&gt;   1e-01       300     0.7605045  0.5107840</span>
<span class="co">#&gt;   1e-01       550     0.7647255  0.5186442</span>
<span class="co">#&gt;   1e-01       800     0.7670722  0.5227352</span>
<span class="co">#&gt;   1e-01      1050     0.7676970  0.5238207</span>
<span class="co">#&gt;   1e+00        50     0.7616152  0.5104787</span>
<span class="co">#&gt;   1e+00       300     0.7617263  0.5102027</span>
<span class="co">#&gt;   1e+00       550     0.7574912  0.5017089</span>
<span class="co">#&gt;   1e+00       800     0.7574773  0.5015711</span>
<span class="co">#&gt;   1e+00      1050     0.7553250  0.4964504</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Tuning parameter 'interaction.depth' was held constant at a value of 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Tuning parameter 'n.minobsinnode' was held constant at a value of 10</span>
<span class="co">#&gt; Accuracy was used to select the optimal model using the largest value.</span>
<span class="co">#&gt; The final values used for the model were n.trees = 1050, interaction.depth =</span>
<span class="co">#&gt;  2, shrinkage = 0.1 and n.minobsinnode = 10.</span></code></pre></div>
<p>Les meilleurs paramètres trouvés sont</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">modele_fin</span><span class="op">$</span><span class="va">bestTune</span>
<span class="co">#&gt;    n.trees interaction.depth shrinkage n.minobsinnode</span>
<span class="co">#&gt; 20    1050                 2       0.1             10</span></code></pre></div>
<p>On peut alors appliquer ce modèle à de nouvelles données.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pred_fin</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span> Y <span class="op">=</span> <span class="va">don_test</span><span class="op">$</span><span class="va">Y</span>,
                     pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/predict.html">predict</a></span><span class="op">(</span><span class="va">modele_fin</span>, <span class="va">don_test</span>, type <span class="op">=</span><span class="st">"prob"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>
<span class="op">)</span>

<span class="fu">eval_prev_classif</span><span class="op">(</span>prev<span class="op">=</span><span class="va">pred_fin</span><span class="op">$</span><span class="va">pred</span>, real<span class="op">=</span><span class="va">pred_fin</span><span class="op">$</span><span class="va">Y</span>, methode<span class="op">=</span><span class="st">"Gradient boosting : adaboost"</span>,     methode_abrev<span class="op">=</span><span class="st">"gbm_ada"</span><span class="op">)</span>
<span class="co">#&gt; [1] "Confusion matrix :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real            0     1</span>
<span class="co">#&gt;   Blessures 11130  2974</span>
<span class="co">#&gt;   Indemne    2594  7307</span>
<span class="co">#&gt; [1] "Confusion matrix (%) :"</span>
<span class="co">#&gt;            prev</span>
<span class="co">#&gt; real           0    1</span>
<span class="co">#&gt;   Blessures 46.4 12.4</span>
<span class="co">#&gt;   Indemne   10.8 30.4</span>
<span class="co">#&gt; [1] "Classification error : 0.232"</span>
<span class="co">#&gt; [1] "Sensitivity : 0.738"</span>
<span class="co">#&gt; [1] "Precision : 0.711"</span>
<span class="co">#&gt; [1] "Accuracy : 0.768"</span>
<span class="co">#&gt; [1] "Specificity : 0.789"</span>
<span class="co">#&gt; [1] "F1 : 0.724"</span>
<span class="co">#&gt; [1] "AUC : 0.85"</span></code></pre></div>
<p><img src="modeles_files/figure-html/unnamed-chunk-24-1.png" width="672"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alexandre Atthar, Cecile Simon, Coralie Bos.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
