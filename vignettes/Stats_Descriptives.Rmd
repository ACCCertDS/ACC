---
title: "Statistiques descriptives avec ggplot2"
output: html_document
---

## Chargement des packages nécessaires au traitement

```{r}
library(lubridate) #Pour représenter l'évolution des accidents par année
library(tidyverse)
library(ggplot2)
library(esquisse)
```

## Evolution du nombre d'accidents par année depuis 2015

```{r}
regr_accidents <- accidents %>%
  mutate(annee = year(date_acc)) %>%
  group_by(annee) %>%
  summarise(nb_accidents = n_distinct(Num_Acc))

ggplot(regr_accidents) +
 aes(x = annee, y = nb_accidents) +
 geom_histogram(stat = "identity", fill = "#440154") +
 labs(x = "Année", y = "Nombre d'accidents",title = "Nombre d'accidents par année") +
 theme_light()

regr_accidents
```

Nous pouvons noter que le nombre d'accidents est relativement constant depuis 2015, à un niveau proche des 60 000 par an (entre 57 783 en 2018 et 60701 en 2017). On a observé une baisse du nombre d'accidents sur les années 2018 et 2019 comparativement à l'année 2017, année pour laquelle le nombre d'accidents est maximal sur la période 2015-2019.

## Evolution du nombre de tués par année depuis 2015

```{r}
regr_tues <- accidents %>%
  filter(grav == "Tué") %>%
  mutate(annee = year(date_acc)) %>%
  #select(Num_Acc,annee,grav) %>%
  group_by(annee,grav) %>%
  summarise(nb_accidents_tues = n_distinct(Num_Acc))

ggplot(regr_tues) +
 aes(x = annee, y = nb_accidents_tues) +
 geom_histogram(stat = "identity", fill = "#440154") +
 labs(x = "Année", y = "Nombre de tués",title = "Nombre de décédés d'un accident de la route par année") +
 theme_light()

regr_tues
```

Tout comme le nombre d'accidents, le nombre de décédés dans un accident de la route est relativement constant au cours du temps (entre 3 186 décédés en 2018 et 3 393 en 2016).
Nous notons par ailleurs que le nombre de décès évolue concomittament au nombre d'accidents. Le nombre d'accidents étant plus faible sur les années 2018 et 2019 (cf. ci-dessus), nous observons que le nombre de tués l'est également. 
Nous relevons néanmoins que la proportion de tués sur la route est plus faible en 2017 qu'en 2016 (5,53 % en 2017 versus 5,7 % en 2016).

## Répartition des accidents par mois et par année

```{r}
acc_par_mois <- accidents %>%
  mutate(annee = year(date_acc)) %>%
  group_by(annee,mois_acc) %>%
  summarise(nb_accidents_mois = n_distinct(Num_Acc))

ggplot(acc_par_mois) +
 aes(x = mois_acc, y=nb_accidents_mois) +
 geom_bar(stat = "identity",fill = "#0c4c8a") +
 labs(x = "Mois", y = "Nombre d'accidents", title = "Répartition des accidents par année et par mois") +
 theme_light() +
 facet_wrap(vars(annee)) +
  theme(axis.text.x = element_text(angle = 90))
```

Tous les ans, le nombre d'accidents est faible aux mois de février et d'août. Concernant le mois d'août, période de vacances d'été, nous pouvons penser qu'il y a également moins d'usagers. A contrario, les mois de juin et juillet sont tous les ans des mois fortement accidentogènes.

## Répartition des accidents de la route par sexe lorsque l'usager est conducteur

```{r}
repart_sexe <- accidents %>%
  mutate(annee = year(date_acc)) %>%
  filter(catu=="Conducteur") %>%
  group_by(annee,sexe) %>%
  summarise(nb_accidents_sexe = n_distinct(Num_Acc))

ggplot(repart_sexe) +
 aes(x = sexe, y = nb_accidents_sexe, fill = sexe) +
 geom_bar(stat = "identity") +
 scale_fill_hue() +
 labs(x = "Sexe", y = "Nombre d'accidents", fill = "Sexe",title = "Répartition des accidents conducteurs de la route par année et par sexe") +
 theme_light() +
 facet_wrap(vars(annee))

repart_sexe
```

Quelle que soit l'année, on note que les femmes sont impliquées dans 2 à 3 fois moins d'accidents que les hommes. Nous étudions la répartition des accidents selon le sexe et la gravité ci-dessous. 

## Répartition des accidents selon le sexe et la gravité (de 2015 à 2019)

```{r}
acc_sexe_grav <- accidents %>%
  group_by(sexe,grav) %>%
  summarise(nb_accidents_sexe_grav = n_distinct(Num_Acc))

ggplot(acc_sexe_grav) +
 aes(x = sexe, y = nb_accidents_sexe_grav, fill = grav) +
 geom_bar(stat = "identity") +
 scale_fill_hue() +
 labs(x = "Sexe", y = "Nombre d'accidents", fill = "Gravité", title="Répartition des accidents selon le sexe et la gravité de 2015 à 2019") +
 theme_light()

acc_sexe_grav
```

## Usagers et gravité de l'accident entre 2015 et 2019

```{r}
us_grav <- accidents %>%
  group_by(catu,grav) %>%
  summarise(nb_accidents_grav = n_distinct(Num_Acc))

ggplot(us_grav) +
 aes(x = catu, y = nb_accidents_grav, fill = grav) +
 geom_bar(stat = "identity") +
 scale_fill_hue() +
  labs(x = "Catégorie d'usager", y = "Nombre d'accidents", fill = "Gravité", title="Répartition des accidents selon la catégorie d'usager et la gravité") +
 theme_light()
```

## Répartition des accidents par âge

```{r}
acc_par_age <- accidents %>%
  group_by(age,grav) %>%
  summarise(nb_accidents_age = n_distinct(Num_Acc))

ggplot(acc_par_age) +
 aes(x = age, y = nb_accidents_age, fill = grav) +
 geom_histogram(stat = "identity") +
 scale_fill_hue() +
  labs(x = "Age", y = "Nombre d'accidents", fill = "Gravité", title="Répartition des accidents par âge et par gravité") +
 theme_light()
```

## Répartition du nombre d'accidents par an et par jour de la semaine

```{r}
acc_par_jour <- accidents %>%
  mutate(annee = year(date_acc)) %>%
  group_by(jour_acc,annee) %>%
  summarise(nb_accidents_jour = n_distinct(Num_Acc))

ggplot(acc_par_jour) +
 aes(x = jour_acc, y = nb_accidents_jour) +
 geom_bar(stat = "identity", fill = "#0c4c8a") +
 labs(x = "Jour de l'accident", y = "Nombre d'accidents", title = "Nombre d'accidents par jour de la semaine et par année") +
 theme_light() +
 facet_wrap(vars(annee)) +
  theme(axis.text.x = element_text(angle = 90))

```

Quelle que soit l'année, nous notons que le vendredi est le jour où se produisent le plus d'accidents.

## Gravité de l'accident

```{r}
gravite <- accidents %>%
  group_by(grav) %>%
  summarise(nb_accidents_gravite = n_distinct(Num_Acc))

ggplot(gravite) +
 aes(x = grav, y = nb_accidents_gravite, fill = grav) +
 geom_bar(stat = "identity") +
 scale_fill_viridis_d(option = "inferno") +
 labs(x = "Gravité", y = "Nombre d'accidents", fill="Gravité", title = "Gravité des accidents ayant eu lieu de 2015 à 2019") +
 theme_light()
```

## Conditions d'éclairage et gravité de l'accident

```{r}
eclairage <- accidents %>%
  group_by(grav,lum) %>%
  summarise(nb_accidents_ecl = n_distinct(Num_Acc))

ggplot(eclairage) +
 aes(x = lum, y = nb_accidents_ecl, fill = grav) +
 geom_bar(stat = "identity") +
 scale_fill_viridis_d(option = "inferno") +
 labs(x = "Conditions d'éclairage", y = "Nombre d'accidents",fill = "Gravité", title = "Conditions d'éclairage et gravité des accidents") +
 theme_light() +
  theme(axis.text.x = element_text(angle = 90))
```

## Répartition des accidents par catégorie de route et par gravité

```{r}
repart_catr <- accidents %>%
  group_by(catr,grav) %>%
  summarise(nb_accidents_catr = n_distinct(Num_Acc))

ggplot(repart_catr) +
 aes(x = catr, y = nb_accidents_catr, fill = grav) +
 geom_bar(stat = "identity") +
 scale_fill_hue() +
 labs(x = "Catégorie de route", y = "Nombre d'accidents", fill = "Gravité", title = "Répartition des accidents par catégorie et par gravité") +
 theme_light() +
  theme(axis.text.x = element_text(angle = 90))
```

## Lien entre port de la ceinture de sécurité et gravité de l'accident

J'aurais préféré une proportion d'accidents graves selon que l'usager portait une ceinture ou non...

```{r}
ceint <- accidents %>%
  group_by(secu1,grav) %>%
  summarise(nb_accidents_ceint = n_distinct(Num_Acc))

ggplot(ceint) +
 aes(x = secu1, y = nb_accidents_ceint, fill = grav) +
 geom_bar(stat = "identity") +
 scale_fill_hue() +
 labs(x = "Equipement de sécurité", y = "Nombre d'accidents", fill = "Gravité", title = "Lien entre port de la ceinture de sécurité et la gravité de l'accident") +
 theme_light() +
  theme(axis.text.x = element_text(angle = 90))
```

## Répartition des accidents par heure de la journée (sur la base de 2015 à 2019)

```{r}
regr_heure <- accidents %>%
  group_by(heure) %>%
  summarise(nb_accidents_h = n_distinct(Num_Acc))

ggplot(regr_heure) +
 aes(x = heure, y = nb_accidents_h) +
 geom_bar(stat = "identity", fill = "#0c4c8a") +
 labs(x = "Heure", y = "Nombre d'accidents", title = "Répartition des accidents par heure de la journée") +
 theme_light()
```

La tranche horaire 16h-19h est la plus accidentogène. Néanmoins, nous pouvons penser que c'est aussi la période de la journée où les usagers sont le plus présents sur la route. 

## Répartition des accidents mortels par heure de la journée (sur la base de 2015 à 2019)

```{r}
regr_heure_tues <- accidents %>%
  filter(grav=="Tué") %>%
  group_by(heure) %>%
  summarise(nb_accidents_h_tues = n_distinct(Num_Acc))

ggplot(regr_heure_tues) +
 aes(x = heure, y = nb_accidents_h_tues) +
 geom_bar(stat = "identity", fill = "#0c4c8a") +
 labs(x = "Heure", y = "Nombre d'accidents", title = "Répartition des accidents mortels par heure de la journée") +
 theme_light()
```

Les accidents mortels se concentrent quant à eux essentiellement sur la tranche horaire 15h - 18h.

## Répartition des accidents par date et par année

```{r}
regr_accidents_date <- accidents %>%
  mutate(annee = year(date_acc)) %>%
  filter(annee == 2019) %>%
  group_by(date_acc,annee) %>%
  summarise(nb_accidents_date = n_distinct(Num_Acc))

ggplot(regr_accidents_date) +
 aes(x = date_acc, y = nb_accidents_date) +
  labs(x = "Date", y = "Nombre d'accidents", title = "Répartition des accidents mortels par heure de la journée") +
 geom_line(size = 1L, colour = "#0c4c8a") +
 theme_light()
```

Nous retrouvons l'effet "vacances d'été" évoqué ci-dessus.
